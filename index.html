<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Send PunchOut XML</title>
</head>
<body>
<button id="sendXmlButton">Wyślij XML</button>

<script>
    document.getElementById("sendXmlButton").addEventListener("click", function() {
        // Tworzymy XML
        const xmlData = `<?xml version="1.0" encoding="UTF-8"?>
            <cXML payloadID="123456789@punchout" timestamp="2025-04-11T12:00:00+01:00">
                <Header>
                    <From>
                        <Credential domain="NetworkId">
                            <Identity>BuyerOrg</Identity>
                        </Credential>
                    </From>
                    <To>
                        <Credential domain="DUNS">
                            <Identity>SupplierOrg</Identity>
                        </Credential>
                    </To>
                    <Sender>
                        <Credential domain="AribaNetworkUserId">
                            <Identity>buyer@example.com</Identity>
                            <SharedSecret>MOJ_SEKRET_123</SharedSecret>
                        </Credential>
                        <UserAgent>PostmanTest</UserAgent>
                    </Sender>
                </Header>
                <Request deploymentMode="production">
                    <PunchOutSetupRequest operation="create">
                        <BuyerCookie>abc123-cookie</BuyerCookie>
                        <BrowserFormPost>
                            <URL>https://example.com/return</URL>
                        </BrowserFormPost>
                        <Contact>
                            <Name xml:lang="en">Test Buyer</Name>
                            <Email>buyer@example.com</Email>
                        </Contact>
                        <SupplierSetup>
                            <URL>https://twojsklep.pl/punchout/setup-request</URL>
                        </SupplierSetup>
                    </PunchOutSetupRequest>
                </Request>
            </cXML>`;

        // Ustawiamy request AJAX
        const xhr = new XMLHttpRequest();
        xhr.open("POST", "https://papirus-medusa-backend.onrender.com/store/punch-out/", true);

        // Dodajemy dodatkowy nagłówek (np. Authorization)
        xhr.setRequestHeader("x-publishable-api-key", "pk_23e8cbfa99ce6d30176e2f192a6b06171b2963a077bf37504ca278dd52fc15a9");

        // Funkcja po zakończeniu wysyłania
        xhr.onload = function() {
            if (xhr.status === 302) {
                console.log(xhr.getAllResponseHeaders());
                // Przekierowanie (302) - przenosi do logowania
                window.location.href = xhr.getResponseHeader("Location");
            } else {
                alert("Błąd: " + xhr.status);
            }
        };

        // Wysyłamy XML do serwera
        xhr.send(xmlData);
    });
</script>
</body>
</html>
